# スネークゲーム - 要件定義書

## プロジェクト概要
餌を食べて体が伸びる定番アクションゲーム。AI対戦機能とプレイスタイル分析を搭載した次世代スネークゲーム。

## 目的・課題
- **目的**: シンプルで中毒性のあるゲーム体験を提供し、反射神経と戦略的思考を鍛える
- **課題**: 従来のスネークゲームは単調で飽きやすい、自分の上達が分からない
- **解決策**: AI 対戦機能とプレイ分析で、常に新鮮な体験と成長実感を提供

## ターゲットユーザー
- カジュアルゲームプレイヤー
- レトロゲームファン
- 暇つぶしに軽く遊びたい人
- AI対戦で競い合いたい人

---

## 機能要件

### 1. ゲーム基本機能

#### 1.1 操作方法
- **PC**: 矢印キー（↑↓←→）
- **スマホ**: スワイプ操作（上下左右）
- **レスポンシブ**: デバイスに応じて自動切り替え

#### 1.2 ゲームルール
- **蛇の移動**: 指定方向に自動移動（停止不可）
- **方向転換**: 矢印キーまたはスワイプで方向変更
- **餌を食べる**: 餌に触れると体が1マス伸びる + スコア加算
- **ゲームオーバー条件**:
  - 壁にぶつかる
  - 自分の体にぶつかる
  - AI対戦モードではAIの体にぶつかる

#### 1.3 フィールド
- **サイズ**: 20×20 グリッド
- **背景**: ダークグレー、グリッドライン表示
- **境界**: 壁あり（ぶつかるとゲームオーバー）

### 2. 餌システム

#### 2.1 通常の餌
- **外見**: 赤い丸（リンゴ風）
- **効果**: 体が1マス伸びる + 10ポイント
- **出現**: ランダムな位置に1つ常に存在

#### 2.2 特殊餌
- **外見**: 金色の星型、発光エフェクト
- **効果**: 体が2マス伸びる + 50ポイント（ボーナス）
- **出現**: ランダムタイミング、30秒間のみ表示
- **種類**:
  - スピードブースト: 一時的に速度上昇
  - スコア2倍: 次の10秒間スコア2倍
  - 体縮小: 体が3マス短くなる（ピンチ回避用）

### 3. 難易度・レベルシステム

#### 3.1 難易度設定
- **初級（Easy）**: 速度 ×1.0、レベルアップ緩やか
- **中級（Medium）**: 速度 ×1.5、標準的なレベルアップ
- **上級（Hard）**: 速度 ×2.0、急速なレベルアップ

#### 3.2 レベルアップシステム
- **条件**: スコア到達（例: 500点ごとにレベルアップ）
- **効果**:
  - 速度上昇（×0.2ずつ増加）
  - レベルアップ通知アニメーション（「LEVEL UP!」表示）
  - 効果音・視覚エフェクト
- **最大レベル**: 10（速度上限 ×4.0）

### 4. ゲームモード（3種類）

#### 4.1 クラシックモード
- **説明**: 伝統的なスネークゲーム
- **目標**: 高スコアを目指す
- **終了条件**: ゲームオーバーまで

#### 4.2 タイムアタックモード
- **説明**: 制限時間内に高スコアを目指す
- **制限時間**: 3分、5分、10分（選択可能）
- **終了条件**: タイムアップまたはゲームオーバー
- **特徴**: 残り時間表示、カウントダウン

#### 4.3 エンドレスモード
- **説明**: ゲームオーバーなし、無限に続く
- **ルール変更**:
  - 壁にぶつかると反対側に出現
  - 自分の体にぶつかると体が3マス短くなる（ペナルティ）
- **目標**: 最長プレイ時間・最高スコア

### 5. AI機能（必須要件）

#### 5.1 プレイスタイル分析
- **機能**: プレイ後に AI がプレイスタイルを分析
- **実装**: OpenAI API または Google Gemini API を使用
- **分析項目**:
  - 平均生存時間
  - スコア効率（時間あたりのスコア）
  - よく使う移動パターン
  - リスクテイク傾向（壁際プレイの頻度等）
  - 特殊餌取得率
- **アドバイス例**:
  - 「壁際を避けると生存時間が30%伸びます」
  - 「特殊餌を積極的に狙うとスコアが1.5倍になります」

#### 5.2 AI スネークと対戦
- **機能**: AI が操作する蛇と同じフィールドで対戦
- **実装**: A*アルゴリズムまたは簡易AIロジック
- **AI動作**:
  - 最短経路で餌を目指す
  - プレイヤーとの衝突を回避
  - 難易度に応じてAIの賢さを調整
- **対戦ルール**:
  - 同じフィールドに2匹の蛇（プレイヤー: 緑、AI: 青）
  - 餌の早取り競争
  - 相手の体にぶつかるとゲームオーバー
  - スコア比較（PLAYER vs AI）
- **勝利条件**:
  - 相手がゲームオーバーになる
  - 制限時間終了時に高スコア側が勝利

### 6. 統計・記録機能

#### 6.1 リアルタイム表示
- **スコア**: 現在のスコア（大きく表示）
- **レベル**: 現在のレベル（Lv.1〜10）
- **速度**: 現在の速度倍率（×1.0〜×4.0）
- **残り時間**: タイムアタックモード時のみ（MM:SS）
- **AI対戦スコア**: PLAYER vs AI（対戦モード時）

#### 6.2 プレイ履歴
- **記録内容**:
  - ハイスコア（モード別）
  - 最長生存時間
  - レベル到達記録
  - AI対戦勝率
- **グラフ**: スコア推移、生存時間推移

### 7. PWA 対応（必須要件）

#### 7.1 オフライン対応
- **Service Worker**: 完全オフライン動作
- **オフライン機能**:
  - ゲームプレイ
  - スコア記録（IndexedDB）
  - AI対戦（ローカルアルゴリズム）
  - プレイ分析（事前キャッシュ済みアドバイス使用）

#### 7.2 インストール可能
- **Manifest.json**: アプリアイコン、名前、テーマカラー設定
- **スタンドアロンモード**: ブラウザUIなしで起動

---

## 技術制約

### 必須技術スタック
- **フロントエンド**: Next.js 14.x / React 18.x
- **スタイリング**: Tailwind CSS v3
- **アニメーション**: Framer Motion または CSS Animations
- **PWA**: Service Worker、Manifest.json
- **AI API**: OpenAI API または Google Gemini API
- **データ保存**: IndexedDB（ローカルストレージ）
- **AI ロジック**: A*アルゴリズム（AI スネーク用）

### API要件
- **AI API キー**: 環境変数で管理（`.env.local`）
- **オフライン対応**: ローカルAIロジックで対戦可能

---

## 環境要件
- **開発環境**: WSL2 Ubuntu + Windows
- **ブラウザ**: Chrome、Firefox、Safari（最新版）
- **レスポンシブ**: デスクトップ、タブレット、スマートフォン対応
- **タッチ操作**: スマホでのスワイプ操作

---

## デザイン要求

### UI参考デザイン
**重要**: 実装時は以下のUIイメージを参考にしてください。

**参考画像**: `png/ui-reference.png`

**デザイン仕様（参考画像に基づく）**:
- **背景**: ダークネイビー〜ブラックのグラデーション（#0f172a → #000000）
- **全体レイアウト**: レトロゲーム風 + モダンなネオンエフェクト
- **レイアウト構成**:
  - **上部中央**: タイトル「SNAKE GAME」（シアンブルー、ネオン風）
  - **上部**: モード選択タブ
    - CLASSIC（緑）、TIME ATTACK（青）、ENDLESS（紫）
  - **統計バー**: 横並びで表示
    - SCORE: 1,250（大きく強調）
    - TIME LEFT: 05:00（タイムアタック時）
    - SPEED: ×2.5
  - **中央メイン**: ゲームフィールド
    - サイズ: 20×20グリッド
    - 背景: ダークグレー（#1f2937）
    - グリッドライン: 薄いグレー（#374151）
    - 角丸、影付き
  - **右サイド**: AI機能エリア
    - ANALYSISボタン（グラフアイコン）
    - AI FIGHTボタン（ロボットアイコン）
    - AIスネーク表示（青い蛇アイコン）
    - スコア比較「PLAYER: vs 580」
  - **下部**: 難易度選択・操作説明
    - EASY、MEDIUM、HARDボタン
    - 操作説明「CONTROLS: PC (ARROW KEYS) / MOBILE (SWIPE)」
    - PWAバッジ

- **ゲーム要素のデザイン**:
  - **プレイヤーの蛇**:
    - 色: 明るい緑〜深緑のグラデーション（#10b981 → #047857）
    - 頭部: 明るい緑、ネオン風グロー
    - 体: 段々暗くなるグラデーション
    - 滑らかな曲線、立体感
  - **AIの蛇**:
    - 色: 明るい青〜深青のグラデーション（#3b82f6 → #1e40af）
    - 同様のグロー効果
  - **通常の餌**:
    - 色: 赤（#ef4444）
    - 形: 丸（リンゴ風）
    - エフェクト: 微細な発光
  - **特殊餌**:
    - 色: 金色（#fbbf24）
    - 形: 星型
    - エフェクト: 強い発光、パルスアニメーション
  - **レベルアップ通知**:
    - テキスト: 「LEVEL UP!」（シアンブルー、大きく）
    - アニメーション: フェードイン + 拡大 + フェードアウト

- **カラーパレット**:
  - 背景: ブラック〜ダークネイビー（#000000、#0f172a）
  - メイン要素: シアンブルー（#06b6d4）
  - プレイヤー: グリーン系（#10b981）
  - AI: ブルー系（#3b82f6）
  - 餌: レッド（#ef4444）
  - 特殊餌: ゴールド（#fbbf24）
  - UI要素: グレー系（#374151、#6b7280）

- **UI要素の詳細**:
  - ネオン風エフェクト: text-shadow、box-shadow でグロー
  - ボタン: 角丸、ホバー時に発光
  - レトロ感: ドットフォント、グリッド表示
  - モダン感: グラスモーフィズム、滑らかなアニメーション

**実装時の注意事項**:
- このデザインを**ベース**として、要件に合わせて調整
- レトロゲーム感とモダンな要素のバランスを保つ
- アニメーションは60fps維持（requestAnimationFrame使用）
- スマホでのタッチ操作エリアを確保

---

## 成功基準

### 機能面
- ✅ 3つのゲームモードが正常動作
- ✅ AI 対戦が自然な動き
- ✅ プレイ分析が的確
- ✅ オフラインで完全動作

### パフォーマンス
- ✅ ゲームループ 60fps 維持
- ✅ 入力レスポンス < 16ms
- ✅ AI API レスポンス < 3秒
- ✅ Lighthouse スコア 90点以上

### ユーザビリティ
- ✅ 初回訪問から30秒以内にプレイ開始可能
- ✅ スマホでのスワイプ操作が直感的
- ✅ AI 対戦が楽しい

---

## スケジュール
- **要件定義**: 作成中
- **技術設計**: 次フェーズ
- **実装計画**: TDD準拠で作成
- **実装**: 後日（実装計画書完成後）

---

## 備考
- 既存アプリとの流用: なし（新規タイプ）
- 将来的な拡張: マルチプレイヤー対戦、カスタムスキン、ランキング機能
